' Gambas class file



Public Sub Run() As Boolean

  Return Not Me.ShowModal()

End

Public Sub btnOK_Click()
Dim res As Result
If Global.IsEdit Then 
  res = Global.DBconn.Edit("stock", "id = &1", GBStock.Selected_Stock)
Else 
  res = Global.DBconn.Create("stock")
Endif 

res!type = ComboBox1.Current.Text
res!man = ComboBox4.Text
res!descrip = TextBox2.Text
res!amount = SpinBox1.Value
res!min = ValueBox2.Value
res!max = ValueBox3.Value
res!reserve = ValueBox4.Value
res!part = TextBox3.Text
res!jobno = ValueBox5.Value
res!locid = Location_Text.Text
res!editdate = Now
If PictureBox1.Picture <> Null Then
  res!image = PictureBox1.Picture.ToString("png", 100)
Endif
  
res.Update
Global.DBconn.Commit()

  Me.Close(True)

End

Public Sub btnCancel_Click()

  Me.Close

End


Public Sub Form_Show()
Me.Title = "Add Stock"
FillComboBox()
Global.FillCombo(ComboBox4, "brands")
FileChooser1.Dir = User.Home & "/Pictures"
FileChooser1.View = FileView.Preview
If Global.IsEdit Then 
  Fill_Fields()
  Me.Title = "Edit Stock"   
Endif

End


Public Sub FillComboBox()
  Dim res As Result
  res = Global.DBconn.Find("types")
  ComboBox1.Clear
  For Each res
    ComboBox1.Add(res!item)
  Next
  ComboBox1.Index = 0
End

Public Sub FileChooser1_Change()

  

End

Public Sub FileChooser1_Enter()

  

End

Public Sub FileChooser1_Activate()
Dim pic As Picture
  pic = Picture.Load(FileChooser1.SelectedPath)
  PictureBox1.Picture = Global.scale_Picture(pic, 260, 260, True)

End

Public Sub Form_Open()

  Button1.Text = String.Chr(178)

End

Public Sub Button1_Click()

  Textbox2.Text = Textbox2.Text & String.Chr(178)
  

End

Public Sub Button3_Click()

  Add_Category.ShowModal
  Global.Get_Types(ComboBox1)

End

Public Sub Button2_Click()

  Brands.ShowModal
  Global.FillCombo(ComboBox4, "brands")
  

End

Public Sub Fill_Fields()
  Dim res As Result
  res = Global.DBconn.Find("stock", "id = &1", GBStock.Selected_Stock)
  ComboBox1.Current.Text = res!type
  ComboBox4.Text = res!man
  Textbox2.Text = res!descrip
  SpinBox1.Value = res!amount
  ValueBox2.Value = res!min
  ValueBox3.Value = res!max
  ValueBox4.Value = res!reserve
  TextBox3.Text = res!part
  ValueBox5.Value = res!jobno
  Location_Text.Text = res!locid 
If res!image <> Null Then
  PictureBox1.Picture = Global.Scale_Picture(Load_picture(res!image), PictureBox1.Width, PictureBox1.Height, True)
Endif
  
  
End

Public Function Load_picture(res As String) As Picture
  Dim p As Picture
  If Len(res) <> 0 Then
    p = Picture.FromString(res)
  Endif
  
  Return p
End 

Public Sub Button4_Click()

  Clipboard.Copy(TextBox2.Text)

End

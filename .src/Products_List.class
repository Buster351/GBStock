' Gambas class file


Public Sub Form_Show()
Dim res As Result
SetupProductsGrid
FillSearchCombo
res = Global.DBconn.Find("products")
FillProductsGrid(res)  

End

Public Sub Button1_Click()

  Me.Close
  

End

Public Sub TextBox1_Change()
Dim res As Result
  
  If Len(TextBox1.text) > 2 Then
    Select Case ComboBox1.Current.Text
      Case "All"
        res = Global.DBconn.Find("products")
        FillProductsGrid(res)
      Case "Description"
        res = Global.SearchFor2(TextBox1.text, "description", "products")
        FillProductsGrid(res)
      Case "Part Number"
        res = Global.SearchFor2(TextBox1.text, "partnum", "products")
        FillProductsGrid(res)
    End Select  
   
    'res = Global.SearchForMulti(TextBox1.text, ["partnum", "description"], "products")
    'FillProductsGrid(res)
  Endif
End

Public Sub FillProductsGrid(res As Result)
  
  'Dim res As Result
  Dim brand As Result
  Dim type As Result
  
  
  GridView1.Clear
  GridView1.Columns.Count = 4
  
  GridView1.Rows.Count = res.Count
      
    For Each res
      GridView1[res.Index, 0].Text = res!id
      GridView1[res.Index, 1].text = res!partnum
      type = Global.DBconn.Find("types", "id= &1", res!category)
      If type.Available Then 
      GridView1[res.Index, 3].Text = type!item
      Endif 
      GridView1[res.Index, 2].text = res!description     
    Next
  
End

Public Sub SetupProductsGrid()
  
GridView1.Columns.Count = 6
GridView1.Columns[0].Alignment = Align.Justify
GridView1.Columns[0].Title = "id"

With GridView1
  .Columns[1].Title = "Part Number"
  .Columns[1].Width = 150
  .Columns[1].Alignment = Align.Center
  
  .Columns[2].Width = 400
  .Columns[2].Alignment = Align.Center
  .Columns[2].Title = "Description"
  
  .Columns[3].Title = "Category"
  .Columns[3].Alignment = Align.Center
  .Columns[4].Title = "Reserved Stock"
  .Columns[4].Alignment = Align.Center
   .Columns[5].Title = "Description"
   .Columns[5].Alignment = Align.Center
  ' .Columns[6].Title = "Min Stock"
  ' .Columns[6].Alignment = Align.Center
  ' .Columns[7].Title = "Location"
  ' .Columns[7].Alignment = Align.Center
  ' .Columns[8].Title = "Part Number"
  ' .Columns[8].Alignment = Align.Center
'GridView1[0, 0].Text = "0,0"
'GridView1[0, 0].Alignment = Align.Center
End With 
  
End
Public Sub FillSearchCombo()
  
  With ComboBox1
    .Add("All")
    .Add("Description")
    .Add("Part Number")
    .Add("Catogory")
    .Index = 0
  End With
  
End

Public Sub GridView1_DblClick()

  Global.selected_product_id = Val(GridView1[GridView1.Row, 0].Text)
  Print Global.selected_product_id
  Me.Close
  

End
